%h2= @plan_category.name
= markdown_if_present(@plan_category.description)

= form_for @plan_category do |f|
  = render :partial => "shared/error_messages", :locals => { :resource => @plan_category }

  - if @plans.empty?
    %p This category has no plans yet.
  - else
    %table.semantic.fullwidth
      %thead
        %tr
          - if @show_order_fields
            %th Order
          %th Plan
          %th Attendee Age
          %th Description
          - if @show_availability
            %th # Available*
          %th.numeric Price
      %tbody
        - @plans.each_with_index do |p, ix|
          %tr
            - if @show_order_fields
              %td= number_field_tag "plan_order[]", ix + 1, min: 1, step: 1, size: 3
            %td= link_to p.name, p
            %td= p.age_range_in_words
            %td= Markdown.new( p.description ).to_html.html_safe
            - if @show_availability
              %td= p.describe_inventory_available
            %td.numeric= p.price_for_display

  - if @show_availability
    %p.smalltext
      * Some plans in this category have limited availability. To reserve
      these, please pay your full cost immediately after registration.

  %br

  - if @show_order_fields
    %div= f.submit 'Update Order'
    %br

-# These three buttons are not part of the above form
- if can? :manage, PlanCategory
  .inline-children
    = button_to 'New Plan', new_plan_path, :method => :get
    = button_to 'Edit this Category', edit_plan_category_path(@plan_category), :method => :get
    = button_to 'Delete this Category', @plan_category, :method => :delete, :confirm => 'Really delete this category? Are you sure?'
